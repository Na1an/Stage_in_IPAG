import os
import sys
import datetime
import numpy as np
import pandas as pd
import seaborn as sns
import vip_hci as vip
import matplotlib.pyplot as plt

from astropy.io import fits
from hciplot import plot_frames, plot_cubes
from astropy.visualization import simple_norm
from photutils.aperture import CircularAperture, aperture_photometry, CircularAnnulus

if __name__ == "__main__":
    print("###### Start to process the data ######")

    contrast = np.zeros((9, 11))
    sn = np.zeros((9, 11))
    flux = np.zeros((9, 11))
            
    #obj = HIP_27321 n_corr = 200 ncomp = 20
    contrast[0] = [-2.755666488498071e-05, -1.7717518878437653e-05, 1.127261893869275e-05, 1.8971475867773045e-05, 2.181171081347015e-05, 2.0760238897494463e-05, 1.9934795419954538e-05, 1.9633073032490313e-05, 1.8924793540214943e-05, 2.792000465216677e-05, 2.6964992217740415e-05]
    sn[0] = [-0.5228131445121323, -0.30104165460901533, -0.003567866196658963, 0.19185633973366983, 0.24692924848238548, 0.2729770492065967, 0.26034921120706545, 0.3250865833143754, 0.421029476736236, 0.8041533930861188, 0.801932165253096]
    flux[0] = [-437.9062636541473, -28.155121549223292, 179.13453829205562, 301.4779962646823, 346.6125101168302, 329.903443907837, 316.7862226977984, 311.9915160848338, 300.73616180376433, 443.68013943155086, 428.50392240207884]

    #obj = HIP_27321 n_corr = 200 ncomp = 50
    contrast[1] = [5.135809899753006e-06, -6.026807736444807e-06, 1.8388346307783215e-05, 1.5891977367425623e-05, 1.5697145155997003e-05, 1.7355253162297504e-05, 1.4067951583574387e-05, 6.978994954446516e-06, 4.238191431658578e-06, 8.444979471621108e-06, 1.2377576008822666e-05]
    sn[1] = [-0.31281152227420767, -0.2960292125784616, 0.8341325195524527, 1.0107969608035867, 1.0697461217130526, 1.0947881616412853, 0.9106430129359215, 0.7547515034633728, 0.4046685079769231, 0.9116090740999703, 1.1237013093019996]
    flux[1] = [81.61377051344849, -95.77272389979576, 292.21141455360555, 252.54131659592156, 249.4452145784135, 275.79440758869777, 223.55550430154375, 110.90404507653318, 67.34960788016741, 134.20018069999344, 196.693543494552]

    #obj = HIP_27321 n_corr = 200 ncomp = 100
    contrast[2] = [-3.0089618618963853e-06, 6.584521669409632e-06, 8.674264524499209e-06, 6.868834423560655e-06, 6.710762161416159e-06, 5.8861886834264025e-06, 6.068665662115094e-06, 1.8763584205500165e-06, 1.3627286943926159e-06, 2.8135915119661697e-06, 4.622606503890183e-06]
    sn[2] = [-0.4270941753119906, 0.7334007281748405, 1.5450068153720036, 2.2748308260400645, 1.8598774271988905, 2.105962281963475, 2.2164473105330904, 0.8295846610016151, 0.722118751014428, 1.1302328076188914, 1.034309309094823]
    flux[2] = [-47.8157734951094, 104.6354228364003, 137.84377694927383, 109.15347088028213, 106.6415256215951, 93.5381296786556, 96.43789321223235, 29.817436494896437, 21.655284971042043, 44.71111985419026, 73.45839385539009]

    #obj = HIP_27321 n_corr = 200 ncomp = 150
    contrast[3] = [-2.645064055733302e-06, 2.268260038581946e-06, 2.7697912433791466e-06, 2.480112808683152e-06, 2.47817947449565e-06, 2.24441351872031e-06, 2.3250671767783817e-06, 3.4631255910475357e-07, 5.854966089425015e-07, 7.873593529044409e-07, 1.213191352009449e-06]
    sn[3] = [-0.4792899902947499, 0.277010430889399, 2.1655885925630898, 2.7801052467611878, 2.3477246234962235, 1.9356979974803268, 2.0097454679210585, 0.5866726803998765, 0.8097016114518445, 0.6893246095973643, 0.6957712977928551]
    flux[3] = [-42.033029853455226, 36.04519206650458, 44.015084537723304, 39.41176982136068, 39.38104697612604, 35.66624416198312, 36.94792110647793, 5.503294373504693, 9.304196769614407, 12.512021822040323, 19.2789691449758]

    #obj = HIP_27321 n_corr = 200 ncomp = 200
    contrast[4] = [-1.0166372832752483e-07, 2.898301031397571e-06, 1.8663632238257133e-06, 9.164876701083731e-07, 1.0503984724724567e-06, 8.927093252282028e-07, 8.826392251075169e-07, 5.421859698095326e-07, 5.095553097648342e-07, 3.615394813662177e-07, 5.935360363275293e-07]
    sn[4] = [-0.3226835952347702, 0.6534718313586025, 2.0695255957005823, 1.276366352151665, 1.5784318379054019, 1.179445866684644, 1.1232816350321908, 1.8487764345260445, 1.5565615188253499, 0.6998723753205, 1.3626376439248744]
    flux[4] = [-1.6155504886703875, 46.05724897776069, 29.65860162607988, 14.564015383479646, 16.692007989658403, 14.186150855757703, 14.026125688093956, 8.615942213471488, 8.097404484744722, 5.745267219721804, 9.43195227351122]

    #obj = HIP_27321 n_corr = 200 ncomp = 250
    contrast[5] = [2.4843052675100674e-07, 1.3621639437255058e-06, 7.776257348832984e-07, 4.1716896392305915e-07, 5.271227771863715e-07, 4.3663442260251583e-07, 3.4960111452145505e-07, 2.4713278683105643e-07, 2.425266478300682e-07, 1.8411943000183587e-07, 3.660644556290266e-07]
    sn[5] = [-0.3326623246799485, 0.2973726718812241, 1.339838816255129, 1.0614339111620126, 1.2693208766681061, 0.7925476905970187, 0.6248522789761277, 0.7787125332539909, 0.6841650400781554, 0.5830884770108715, 0.9808694762201534]
    flux[5] = [3.9478392686938975, 21.646310450519962, 12.35734373173926, 6.629281992814222, 8.376571214555494, 6.938609929130672, 5.555553201681402, 3.9272167281247734, 3.854020021331211, 2.925863924200046, 5.817174127935426]

    #obj = HIP_27321 n_corr = 200 ncomp = 300
    contrast[6] = [1.139856418021869e-06, 9.364333461214232e-07, 7.419437857796974e-07, 2.743350415747988e-07, 4.2748079444901427e-07, 2.0142202742979755e-07, 1.723197257447135e-07, 1.50345870810581e-07, 2.3653088151679704e-07, 1.5978769451276148e-07, 2.3272192799252834e-07]
    sn[6] = [0.11826445573211225, 0.14602484928143233, 1.6050374562894962, 1.3604915834954316, 1.5493477642301372, 1.2408639994709703, 0.7543074190354463, 0.7988421928562996, 1.2387575441580678, 0.8015275591714326, 0.6605798466056945]
    flux[6] = [18.113594921648517, 14.88097451098609, 11.790317602957916, 4.359491017757442, 6.793148527313357, 3.2008215732049594, 2.7383534099550264, 2.3891642481878934, 3.7587405804065943, 2.5392054000021878, 3.698212043546029]

    #obj = HIP_27321 n_corr = 200 ncomp = 350
    contrast[7] = [-1.338841508697432e-07, 9.364333461214232e-07, 4.988913968498375e-07, 2.3301948722226496e-07, 2.4240674404085055e-07, 9.841889893164461e-08, 1.2975221228952987e-07, 1.8263814075999404e-07, 1.1716222661052556e-07, 4.6741533124175416e-08, 2.1921323046088326e-07]
    sn[7] = [-0.3296537592833576, 0.14602484928143233, 1.209798515288516, 1.2662718846875654, 1.2102735580001018, 0.5806167885496506, 0.6366309129889928, 1.4873331166409542, 0.8656235028740799, 0.23661114539298805, 0.6621755936314907]
    flux[7] = [-2.127569084088691, 14.88097451098609, 7.927942966813188, 3.7029405929206956, 3.852114615849327, 1.5639865159300033, 2.0619079530025477, 2.9023245793630155, 1.861838981987231, 0.7427753036627512, 3.483543712396098]

    #obj = HIP_27321 n_corr = 200 ncomp = 400
    contrast[8] = [-3.694332386052177e-08, 9.364333461214232e-07, 3.762519337894952e-07, 1.2528704733623194e-07, 2.50520186630888e-07, 7.425606417230714e-08, 1.1127528179611209e-07, 1.5585394371664376e-07, 4.786192168084748e-08, 5.055283467537014e-08, 1.7590608862351338e-07]
    sn[8] = [-0.28586630612633296, 0.14602484928143233, 1.5327123379238423, 0.803059634597942, 1.3916123605833417, 0.47912909287923916, 0.9470949081263945, 1.407970919687407, 0.29939121083366715, 0.21524254811066745, 0.8372989398157668]
    flux[8] = [-0.5870707861873221, 14.88097451098609, 5.9790645640941396, 1.9909514816929934, 3.9810463042377937, 1.1800120134668604, 1.7682888365404568, 2.4766936947408835, 0.7605795324669609, 0.8033411533005496, 2.7953447321966074]   
    
    ##################
    # plot te result #
    ##################
    
    data_total = pd.DataFrame(contrast[1:].T, columns=["ncomp_050","ncomp_100","ncomp_150","ncomp_200","ncomp_250", "ncomp_300","ncomp_350","ncomp_400"])
    data_total.index = [641,1283,2567,5134,7702,10269,12836,25673,38510,64184,128368]

    print("######### Contrast of companion #######")
    print(data_total)
    #data_total.to_csv("Flux_of_companion.csv")
    #data_total.plot(kind='line', style='--o', title='comparation')
    sns.set(font_scale = 1.5)
    sns.relplot(kind='line',data=data_total)
    plt.title("The contrast changes with the size of the reference library, science target Beta Pictoris, ncorr=200", fontsize = 20)
    plt.xlabel("The size of reference library", fontsize = "18")
    plt.ylabel("contrast", fontsize = "18")
    #plt.ylim(0,70)
    plt.show()
    
    print("###### End of program ######")
